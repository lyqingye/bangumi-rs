# 智能下载

智能下载是 Bangumi-rs 的核心功能之一，它能根据用户设置自动选择最佳资源并管理下载过程。

## 下载管理界面

![下载管理](/screenshot/download.png)

下载管理界面提供了直观的任务监控和控制功能，让你可以轻松管理所有下载任务。

## 下载功能特点

### 智能选种

- **最佳种子选择**: 根据用户设置的分辨率、字幕组、字幕语言等偏好自动选择最佳种子
- **多重评分机制**: 综合考虑分辨率匹配度、字幕匹配度、种子热度等因素评分
- **手动选择**: 支持用户手动选择要下载的剧集种子

### 下载方式

- **本地下载**: 直接下载到本地存储
- **115 网盘离线下载**: 支持将种子发送到 115 网盘进行离线下载
- **多任务并行**: 支持多个下载任务同时进行，可设置最大并行任务数

### 失败处理

- **自动重试**: 下载失败后自动尝试其它种子
- **重试策略**: 可配置最大重试次数和重试间隔
- **错误报告**: 详细记录下载失败原因，便于排查

### 下载控制

- **暂停/恢复**: 支持暂停和恢复下载任务
- **取消**: 可随时取消正在进行的下载任务
- **优先级调整**: 可调整下载任务的优先级
- **限速设置**: 可设置全局或单任务的下载速度限制

## 使用方法

### 自动下载

1. 设置番剧订阅并启用自动下载
2. 系统检测到新剧集后会自动选择最佳种子并开始下载
3. 下载完成后会发送通知

### 手动下载

1. 在番剧详情页面找到想要下载的剧集
2. 点击 "下载" 按钮
3. 在弹出的种子选择面板中选择合适的种子
4. 点击 "确认" 开始下载

### 管理下载任务

1. 进入下载管理页面查看所有下载任务
2. 可以执行以下操作：
   - 暂停/恢复任务
   - 取消任务
   - 重试失败的任务
   - 查看详细日志
   - 调整任务优先级

## 下载工作流程

1. **种子选择**: 根据订阅设置或用户手动选择种子
2. **任务创建**: 创建下载任务并加入队列
3. **资源分配**: 根据优先级和系统负载分配资源
4. **下载执行**: 执行下载过程，实时更新进度
5. **完成处理**: 下载完成后整理文件并发送通知
6. **失败处理**: 下载失败时尝试其它种子或通知用户

## 下载目录结构

默认情况下，Bangumi-rs 会按以下结构组织下载的文件：

```
/下载根目录
  /番剧名称
    /Season 01
      番剧名称 - S01E01.mp4
      番剧名称 - S01E02.mp4
      ...
    /Season 02
      ...
```

你可以在设置中自定义下载目录结构。

## 115 网盘集成

Bangumi-rs 支持将种子发送到 115 网盘进行离线下载，使用步骤如下：

1. 在设置页面配置 115 网盘账号信息
2. 在下载设置中选择 "115 网盘离线下载" 作为下载方式
3. 系统会自动将种子发送到 115 网盘，并监控下载状态
4. 下载完成后可以直接在 115 网盘查看或通过 Bangumi-rs 在线播放

## 性能优化

- **并行下载**: 可配置最大并行下载任务数，根据网络和系统性能调整
- **磁盘缓存**: 优化磁盘写入，减少磁盘碎片
- **网络优化**: 智能调整连接数和请求频率，提高下载速度
- **资源监控**: 实时监控系统资源使用情况，避免过载

## 最佳实践

- **合理设置并行任务数**: 根据你的网络带宽和系统性能设置合适的并行任务数
- **使用 115 网盘**: 对于大文件或需要长时间下载的资源，推荐使用 115 网盘离线下载
- **定期清理**: 定期清理已完成的下载任务记录，保持界面整洁
- **设置下载时间**: 可以设置允许下载的时间段，避免占用高峰期带宽

## 常见问题

- **下载速度慢怎么办?**

  - 检查网络连接
  - 调整并行任务数
  - 考虑使用代理或 VPN
  - 尝试使用 115 网盘离线下载

- **下载失败如何处理?**

  - 查看详细错误日志
  - 手动选择其他种子
  - 检查磁盘空间
  - 确认网络连接正常

- **如何批量下载整季番剧?**
  - 在番剧详情页面选择 "下载全部" 选项
  - 或在订阅设置中启用自动下载
