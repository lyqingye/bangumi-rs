import{_ as i,c as a,o as t,ag as l}from"./chunks/framework.Ckikgd0K.js";const c=JSON.parse('{"title":"服务器配置","description":"","frontmatter":{},"headers":[],"relativePath":"configuration/server.md","filePath":"configuration/server.md","lastUpdated":1741430793000}'),n={name:"configuration/server.md"};function e(o,s,h,p,r,d){return t(),a("div",null,s[0]||(s[0]=[l(`<h1 id="服务器配置" tabindex="-1">服务器配置 <a class="header-anchor" href="#服务器配置" aria-label="Permalink to &quot;服务器配置&quot;">​</a></h1><p>服务器配置部分控制 Bangumi-rs 的基本运行参数，包括监听地址、数据库连接和资源路径等。</p><h2 id="配置项" tabindex="-1">配置项 <a class="header-anchor" href="#配置项" aria-label="Permalink to &quot;配置项&quot;">​</a></h2><p>服务器配置位于配置文件的 <code>[server]</code> 部分：</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">assets_path = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./assets&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">listen_addr = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:3001&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">database_url = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sqlite:bangumi.db&quot;</span></span></code></pre></div><h3 id="监听地址-listen-addr" tabindex="-1">监听地址 (listen_addr) <a class="header-anchor" href="#监听地址-listen-addr" aria-label="Permalink to &quot;监听地址 (listen_addr)&quot;">​</a></h3><ul><li><strong>说明</strong>: 设置 Bangumi-rs Web 服务器的监听地址和端口</li><li><strong>默认值</strong>: <code>&quot;127.0.0.1:3001&quot;</code></li><li><strong>格式</strong>: <code>&quot;IP地址:端口号&quot;</code></li><li><strong>示例</strong>: <ul><li><code>&quot;127.0.0.1:3001&quot;</code>: 仅本地访问，端口 3001</li><li><code>&quot;0.0.0.0:80&quot;</code>: 允许所有网络接口访问，端口 80</li></ul></li></ul><div class="warning custom-block"><p class="custom-block-title">注意</p><p>如果设置为 <code>0.0.0.0</code>，服务将对外网开放。在公网环境中，建议配置反向代理和身份验证。</p></div><h3 id="资源路径-assets-path" tabindex="-1">资源路径 (assets_path) <a class="header-anchor" href="#资源路径-assets-path" aria-label="Permalink to &quot;资源路径 (assets_path)&quot;">​</a></h3><ul><li><strong>说明</strong>: 设置静态资源文件的存储路径</li><li><strong>默认值</strong>: <code>&quot;./assets&quot;</code></li><li><strong>格式</strong>: 文件系统路径</li><li><strong>示例</strong>: <ul><li><code>&quot;./assets&quot;</code>: 相对于应用程序的路径</li><li><code>&quot;/var/lib/bangumi/assets&quot;</code>: 绝对路径</li></ul></li></ul><div class="tip custom-block"><p class="custom-block-title">提示</p><p>此路径用于存储应用程序的静态资源，如图片、CSS、JavaScript 文件等。确保应用程序对此路径有读写权限。</p></div><h3 id="数据库-url-database-url" tabindex="-1">数据库 URL (database_url) <a class="header-anchor" href="#数据库-url-database-url" aria-label="Permalink to &quot;数据库 URL (database_url)&quot;">​</a></h3><ul><li><strong>说明</strong>: 设置数据库连接字符串</li><li><strong>默认值</strong>: <code>&quot;sqlite:bangumi.db&quot;</code></li><li><strong>格式</strong>: 数据库连接 URL</li><li><strong>支持的数据库</strong>: <ul><li>SQLite: <code>&quot;sqlite:文件名.db&quot;</code></li><li>MySQL: <code>&quot;mysql://用户名:密码@主机:端口/数据库名&quot;</code></li><li>PostgreSQL: <code>&quot;postgres://用户名:密码@主机:端口/数据库名&quot;</code></li></ul></li></ul><p><strong>示例</strong>:</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SQLite (文件数据库)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">database_url = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sqlite:bangumi.db&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># MySQL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">database_url = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mysql://root:password@localhost:3306/bangumi&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PostgreSQL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">database_url = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;postgres://postgres:password@localhost:5432/bangumi&quot;</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p><p>更改数据库连接需要重启应用程序才能生效。确保数据库服务器已经运行，并且用户有足够的权限。</p></div><h3 id="最大连接数-max-connections" tabindex="-1">最大连接数 (max_connections) <a class="header-anchor" href="#最大连接数-max-connections" aria-label="Permalink to &quot;最大连接数 (max_connections)&quot;">​</a></h3><ul><li><strong>说明</strong>: 设置数据库连接池的最大连接数</li><li><strong>默认值</strong>: <code>10</code></li><li><strong>格式</strong>: 整数</li><li><strong>示例</strong>: <code>max_connections = 20</code></li></ul><div class="tip custom-block"><p class="custom-block-title">提示</p><p>对于高负载系统，可以适当增加此值。但过多的连接可能会导致数据库服务器压力过大。</p></div><h3 id="会话超时-session-timeout" tabindex="-1">会话超时 (session_timeout) <a class="header-anchor" href="#会话超时-session-timeout" aria-label="Permalink to &quot;会话超时 (session_timeout)&quot;">​</a></h3><ul><li><strong>说明</strong>: 设置用户会话的超时时间</li><li><strong>默认值</strong>: <code>&quot;24h&quot;</code></li><li><strong>格式</strong>: 时间字符串，支持 <code>s</code>(秒)、<code>m</code>(分)、<code>h</code>(小时)、<code>d</code>(天)</li><li><strong>示例</strong>: <code>session_timeout = &quot;48h&quot;</code></li></ul><h2 id="高级配置" tabindex="-1">高级配置 <a class="header-anchor" href="#高级配置" aria-label="Permalink to &quot;高级配置&quot;">​</a></h2><h3 id="cors-设置-cors" tabindex="-1">CORS 设置 (cors) <a class="header-anchor" href="#cors-设置-cors" aria-label="Permalink to &quot;CORS 设置 (cors)&quot;">​</a></h3><ul><li><strong>说明</strong>: 配置跨域资源共享 (CORS) 设置</li><li><strong>默认值</strong>: 仅允许同源请求</li><li><strong>示例</strong>:</li></ul><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allowed_origins = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://sub.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allowed_methods = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PUT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DELETE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allow_credentials = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><h3 id="tls-配置-tls" tabindex="-1">TLS 配置 (tls) <a class="header-anchor" href="#tls-配置-tls" aria-label="Permalink to &quot;TLS 配置 (tls)&quot;">​</a></h3><ul><li><strong>说明</strong>: 配置 HTTPS 支持</li><li><strong>默认值</strong>: 禁用 TLS</li><li><strong>示例</strong>:</li></ul><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cert_file = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/path/to/cert.pem&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key_file = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/path/to/key.pem&quot;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p><p>在生产环境中，建议使用 HTTPS 保护数据传输安全。你也可以使用 Nginx 或 Caddy 等反向代理服务器处理 TLS 终结。</p></div><h2 id="环境变量" tabindex="-1">环境变量 <a class="header-anchor" href="#环境变量" aria-label="Permalink to &quot;环境变量&quot;">​</a></h2><p>你可以使用环境变量覆盖配置文件中的服务器设置：</p><ul><li><code>BANGUMI_SERVER_LISTEN_ADDR</code>: 监听地址</li><li><code>BANGUMI_SERVER_ASSETS_PATH</code>: 资源路径</li><li><code>BANGUMI_SERVER_DATABASE_URL</code>: 数据库 URL</li><li><code>BANGUMI_SERVER_MAX_CONNECTIONS</code>: 最大连接数</li><li><code>BANGUMI_SERVER_SESSION_TIMEOUT</code>: 会话超时</li></ul><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2><ol><li><p><strong>生产环境配置</strong>:</p><ul><li>使用反向代理 (如 Nginx) 处理 TLS 和访问控制</li><li>将监听地址设置为 <code>127.0.0.1</code> 并通过反向代理访问</li><li>使用专用数据库用户，并限制其权限</li></ul></li><li><p><strong>开发环境配置</strong>:</p><ul><li>使用 SQLite 简化配置</li><li>设置详细的日志级别便于调试</li></ul></li><li><p><strong>Docker 环境配置</strong>:</p><ul><li>监听地址设置为 <code>0.0.0.0</code> 以允许容器外访问</li><li>使用环境变量注入敏感信息</li><li>使用数据卷持久化数据库和资源</li></ul></li></ol><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><h3 id="基本配置" tabindex="-1">基本配置 <a class="header-anchor" href="#基本配置" aria-label="Permalink to &quot;基本配置&quot;">​</a></h3><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">listen_addr = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:3001&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">assets_path = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./assets&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">database_url = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sqlite:bangumi.db&quot;</span></span></code></pre></div><h3 id="生产环境配置" tabindex="-1">生产环境配置 <a class="header-anchor" href="#生产环境配置" aria-label="Permalink to &quot;生产环境配置&quot;">​</a></h3><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">listen_addr = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:3001&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">assets_path = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/var/lib/bangumi/assets&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">database_url = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mysql://bangumi_user:password@db.example.com:3306/bangumi_prod&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">max_connections = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">session_timeout = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;12h&quot;</span></span></code></pre></div><h3 id="docker-环境配置" tabindex="-1">Docker 环境配置 <a class="header-anchor" href="#docker-环境配置" aria-label="Permalink to &quot;Docker 环境配置&quot;">​</a></h3><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">listen_addr = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:3001&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">assets_path = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/app/assets&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">database_url = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sqlite:/app/data/bangumi.db&quot;</span></span></code></pre></div>`,41)]))}const u=i(n,[["render",e]]);export{c as __pageData,u as default};
