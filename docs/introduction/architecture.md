# 技术架构

Bangumi-rs 采用前后端分离的架构设计，后端使用 Rust 语言开发，前端基于 Vue 3 框架构建。这种架构设计既保证了系统的高性能和稳定性，又提供了良好的用户界面和交互体验。

## 系统架构图

```
+------------------+        +------------------+
|                  |        |                  |
|   前端 (Vue 3)    | <----> |   后端 (Rust)    |
|                  |        |                  |
+------------------+        +------------------+
                                    |
                                    v
+------------------+        +------------------+
|                  |        |                  |
|   资源站点 API    | <----> |   数据库 (SQLite) |
|                  |        |                  |
+------------------+        +------------------+
```

## 前端技术栈

- **框架**: Vue 3 + TypeScript
- **UI 组件库**: Vuetify 3
- **构建工具**: Vite
- **路由管理**: Vue Router
- **HTTP 客户端**: Axios
- **实时通信**: WebSocket
- **状态管理**: Vue 3 Composition API

前端采用组件化开发模式，使用 Composition API 进行状态管理，通过 WebSocket 实现与后端的实时通信，确保下载状态和进度的及时更新。

## 后端技术栈

- **语言**: Rust
- **异步运行时**: tokio
- **数据库 ORM**: sea-orm + SQLite
- **错误处理**: anyhow + thiserror
- **日志系统**: tracing
- **序列化/反序列化**: serde
- **异步通信**: tokio channels

后端采用 Rust 语言开发，充分利用其内存安全和高性能特性。使用 tokio 作为异步运行时，处理并发任务；采用 sea-orm 作为 ORM 框架，简化数据库操作；使用 tracing 进行结构化日志记录，方便问题排查。

## 数据流程

1. **番剧订阅流程**:

   - 用户在前端添加订阅
   - 后端定期检查资源站点更新
   - 发现新剧集时触发下载流程
   - 通知用户新剧集已下载

2. **下载管理流程**:

   - Worker 模式处理下载任务
   - 任务队列管理并发下载
   - 状态更新通过 WebSocket 实时反馈
   - 下载完成后自动整理文件

3. **元数据管理流程**:
   - 从多个数据源获取番剧信息
   - 合并和优化元数据
   - 缓存元数据减少 API 请求
   - 定期更新保持信息最新

## 设计原则

Bangumi-rs 的架构设计遵循以下原则：

- **高内聚低耦合**: 模块化设计，各组件职责明确
- **可扩展性**: 易于添加新的资源站点和功能模块
- **容错性**: 完善的错误处理和重试机制
- **性能优先**: 异步处理和资源优化
- **用户体验**: 响应式设计和实时反馈
